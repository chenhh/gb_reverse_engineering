# 逆向工程簡介

## 甚麼是 逆向工程(Reverse Engineering)?

逆向工程是指一般意義上的軟體分析，其物件不僅限於惡意軟體，因此也不一定和電腦安全有關。在軟體領域，逆向工程主要指的是程式碼反組譯已經被編為二進制的機械碼，還原為器語言轉換成組合語言後的程式碼的技術，以及使用除錯器分析軟體行為等工作。

基本上大部份程式於機器上運行時，需要將其高階程式藉由編譯器編譯成組合語言，然後再組譯成機械碼。一般而言這些機械碼都是二進制人類無法閱讀，但是機器可以理解與執行。

逆向工程按照程式語言類別，可以分為:

* 解釋型語言的逆向(如Android APP)
* 編譯型語言的逆向(如C/C++、Objective-C)

解釋型語言(如Java)的執行環境是JVM之類的虛擬機器，其反編譯的難度通常較低。以Java語言為例，編譯器編譯的結果通常是.class或者.dex檔案，在沒有做程式碼混淆的情況下，很容易反彙編出Java原始碼，分析出程式碼邏輯。而且混淆也只是將類、方法、變數名稱替換成a b c d這種沒有任何意義的名字，增加理解難度而已。

編譯型語言(如C/C++，Objective-C等)最終編譯出來的機器程式碼就比較複雜，因為其機器程式碼是跟CPU架構相關的，因此針對不同的CPU架構編譯出來的二進位制檔案是不同的，反組譯得到的程式碼也會不一樣。往往需要針對特定的CPU架構去解讀組合語言，才能正確的分析出結果出來，這就需要對不同架構CPU的暫存器、定址方式等特性有所瞭解才行。另外二進位制檔案反組譯出來的函式、變數名通常是機器生成的無意義字串，所以分析難度通常相較於解釋型語言會更大一些。

## 逆向工程的目的是甚麼？

* 透過反組譯之後的結果，可以找到一些原本隱藏於程式碼中，不打算讓使用者知道的資訊。  (如:金鑰，記憶體位置，安全漏洞，尚未公佈的系統功能等)。
* 一直以來，在電腦病毒分析、防止軟體非法使用的防拷貝技術，以及評估軟體強度的抗篡改測試等領域都會用到逆向工程技術。
* 由其結果去修改原程式的二進碼達到驗證的繞過與跳過。
* 還原該程式原始程式碼之後進行修改然後再開發或分享。

此外，由於逆向工程常常被用於惡意軟體分析、防拷貝等領域，因此也經常被歸為安全技術的一種。



## 如何進行逆向工程？

如果我們能對以下三個方面進行監控，那麼就不難跟蹤軟體的行為：

* 檔案的創建、修改和刪除。
* 註冊表專案的創建、修改和刪除。
* 網路通信。

### 靜態分析、動態分析與網路流量分析&#xD;

* 靜態分析：在不執行目的程式的情況下進行分析
  * 閱讀反組譯程式碼
  * 提取可執行檔中的字串，分析使用了哪些單詞
  *   通過分析這些比較低階的程式語言的程式碼，找到程式的業務流程或設計邏輯。


* 動態分析：在執行目的程式的同時進行分析
  * 通過斷點偵錯手段，讓程式單步執行進行分析。動態分析往往是在靜態分析出一定的結果的基礎上進行，找到合適的地方給程式碼打斷點，即時地讀取當前變數的值，來進一步分析程式的邏輯、獲取程式關鍵資料。
* 網路流量分析：通過代理方式或者其他方式，擷取程式與伺服器通訊的資料流量（抓包），來分析客戶端和服務端的通訊協議。
  *



      網路流量分析比較有侷限性，若客戶端使用HTTP這種明文傳輸的協議，會比較容易分析；但如果客戶端使用SSL、HTTPs等加密傳輸協議與服務端進行通訊，那麼抓包的前提是需要拿到服務端下發給客戶端的證書才能進一步解密分析，這種情況下就比較棘手。



在軟體分析中，我們需要按照目的和需要選擇使用靜態分析還是動態分析。靜態分析和動態分析的區別在於「是否執行目的程式」 。**靜態分析比較偏向於「綜覽全域」，而動態分析則比較偏向於「細看局部」**。

&#x20;使用一些靜態或動態反組譯工具(如: IDA ，Ghidra ，etc)將程式反組譯(甚至反編譯)並且分析與修改。而動態分析(如Olly Dbg) 查看暫存器和記憶體資料了，這個功能可以在程式中斷執行的狀態下確認暫存器、記憶體和變數的狀態。

## 常用軟體

* Ghidra
* IDA
* Radare2
